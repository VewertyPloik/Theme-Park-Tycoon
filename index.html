<!DOCTYPE html>
<html>
<head>
  <title>Theme Park Tycoon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; font-family: 'Nunito', sans-serif; }
    body, html { margin: 0; padding: 0; background: #e0f7fa; color: #333; }
    .screen { display: none; padding: 20px; text-align: center; }
    .active { display: block; }
    h1 { font-size: 2.5em; margin-bottom: 0.5em; }
    button {
      padding: 10px 20px; margin: 10px; border: none;
      background: #4db6ac; color: white; font-size: 1em;
      border-radius: 10px; cursor: pointer;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(16, 30px);
      gap: 3px;
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      width: 30px; height: 30px;
      background: #fff;
      border: 1px solid #b2dfdb;
      user-select: none;
      cursor: pointer;
      font-size: 20px;
      line-height: 30px;
      font-weight: 700;
      color: #00695c;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .building {
      background: #80cbc4;
      cursor: pointer;
    }
    .shop {
      margin: 20px auto;
      text-align: center;
    }
    .shop button {
      display: block;
      width: 90%;
      max-width: 300px;
      margin: 5px auto;
    }
    #incomePerMin, #paycheckCountdown {
      position: fixed;
      top: 20px;
      background: #4db6ac;
      color: white;
      padding: 10px 15px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      font-weight: 700;
      font-size: 1.2em;
      user-select: none;
      z-index: 9999;
    }
    #incomePerMin {
      right: 20px;
    }
    #paycheckCountdown {
      right: 180px;
    }
    #infoPopup {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: #4db6ac;
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1em;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      user-select: none;
      display: none;
      z-index: 10000;
    }
  </style>
</head>
<body>
  <div id="home" class="screen active">
    <h1>Theme Park Tycoon</h1>
    <button onclick="showScreen('howTo')">How to Play</button>
    <button onclick="startGame()">Play</button>
    <button onclick="resetProgress()">Reset Progress</button>
  </div>

  <div id="howTo" class="screen">
    <h1>How to Play</h1>
    <p>Buy rides and food stands to earn money. Tap empty grid spots to place attractions. Earn income every minute!</p>
    <button onclick="showScreen('home')">Back to Home</button>
  </div>

  <div id="game" class="screen">
    <h1>Theme Park</h1>
    <div id="paycheckCountdown">Next paycheck in: 60s</div>
    <div id="incomePerMin">Income: $0/min</div>
    <div id="money">Money: $100</div>
    <div class="shop">
      <button onclick="buy('Bumper Cars', 100, 10, 'üé°')">üé° Bumper Cars - $100 (+$10/min)</button>
      <button onclick="buy('Carousel', 1000, 120, 'üé†')">üé† Carousel - $1000 (+$120/min)</button>
      <button onclick="buy('Ferris Wheel', 25000, 1000, 'üé°')">üé° Ferris Wheel - $25,000 (+$1K/min)</button>
      <button onclick="buy('Roller Coaster', 1000000, 80000, 'üé¢')">üé¢ Roller Coaster - $1M (+$80K/min)</button>
      <button onclick="buy('Hot Dog Stand', 120, 10, 'üå≠')">üå≠ Hot Dog Stand - $120 (+$10/min)</button>
      <button onclick="buy('Drink Station', 150, 15, 'ü•§')">ü•§ Drink Station - $150 (+$15/min)</button>
      <button onclick="buy('Ice Cream Truck', 250, 25, 'üç¶')">üç¶ Ice Cream Truck - $250 (+$25/min)</button>
    </div>
    <div id="grid"></div>
    <button onclick="goHome()">Back to Home</button>
  </div>

  <div id="infoPopup"></div>

  <script>
    const grid = document.getElementById('grid');
    const moneyDisplay = document.getElementById('money');
    const incomeDisplay = document.getElementById('incomePerMin');
    const countdownDisplay = document.getElementById('paycheckCountdown');
    const infoPopup = document.getElementById('infoPopup');

    let money = 100;
    let incomePerMinute = 0;
    let selected = null;
    let cells = [];
    let incomeInterval;
    let countdownInterval;
    let countdownSeconds = 60;

    const SAVE_KEY = 'themeParkTycoonSave';

    // Map attraction names to their emojis and income for easy lookup
    const attractionData = {
      'Bumper Cars': { emoji: 'üé°', income: 10 },
      'Carousel': { emoji: 'üé†', income: 120 },
      'Ferris Wheel': { emoji: 'üé°', income: 1000 },
      'Roller Coaster': { emoji: 'üé¢', income: 80000 },
      'Hot Dog Stand': { emoji: 'üå≠', income: 10 },
      'Drink Station': { emoji: 'ü•§', income: 15 },
      'Ice Cream Truck': { emoji: 'üç¶', income: 25 }
    };

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      hideInfo();
    }

    function startGame() {
      showScreen('game');
      if (cells.length === 0) {
        // Create grid cells once
        for (let i = 0; i < 256; i++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.index = i;
          cell.onclick = () => {
            if (cell.classList.contains('building')) {
              showInfo(cell);
            } else {
              place(cell);
            }
          };
          grid.appendChild(cell);
          cells.push(cell);
        }
      }
      loadGame();
      updateMoney();
      updateIncome();
      startCountdown();
      if (incomeInterval) clearInterval(incomeInterval);
      incomeInterval = setInterval(() => {
        money += incomePerMinute;
        updateMoney();
        saveGame();
      }, 60000); // 1 minute intervals
    }

    function buy(name, cost, income, emoji) {
      selected = { name, cost, income, emoji };
      hideInfo();
    }

    function place(cell) {
      if (!selected) return;
      if (cell.classList.contains('building')) return;
      if (money < selected.cost) {
        alert("Not enough money!");
        return;
      }
      money -= selected.cost;
      incomePerMinute += selected.income;
      cell.classList.add('building');
      cell.textContent = selected.emoji;
      cell.dataset.name = selected.name;
      cell.dataset.income = selected.income;
      updateMoney();
      updateIncome();
      saveGame();
    }

    function showInfo(cell) {
      const name = cell.dataset.name;
      const income = cell.dataset.income;
      if (name && income) {
        infoPopup.textContent = `${name} earns $${parseInt(income).toLocaleString()}/min`;
        infoPopup.style.display = 'block';
        clearTimeout(infoPopup.timeout);
        infoPopup.timeout = setTimeout(() => {
          infoPopup.style.display = 'none';
        }, 3000);
      }
    }

    function hideInfo() {
      infoPopup.style.display = 'none';
      if (infoPopup.timeout) clearTimeout(infoPopup.timeout);
    }

    function updateMoney() {
      moneyDisplay.textContent = `Money: $${money.toLocaleString()}`;
    }

    function updateIncome() {
      incomeDisplay.textContent = `Income: $${incomePerMinute.toLocaleString()}/min`;
    }

    function saveGame() {
      const buildings = cells.map(cell => {
        if (cell.classList.contains('building')) {
          return {
            emoji: cell.textContent,
            name: cell.dataset.name,
            income: cell.dataset.income
          };
        }
        return null;
      });
      const saveData = {
        money,
        incomePerMinute,
        countdownSeconds,
        buildings
      };
      localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
    }

    function loadGame() {
      const saved = localStorage.getItem(SAVE_KEY);
      if (!saved) return;
      try {
        const data = JSON.parse(saved);
        money = data.money !== undefined ? data.money : 100;
        incomePerMinute = data.incomePerMinute || 0;
        countdownSeconds = data.countdownSeconds !== undefined ? data.countdownSeconds : 60;
        if (data.buildings && data.buildings.length === cells.length) {
          data.buildings.forEach((b, i) => {
            if (b) {
              cells[i].classList.add('building');
              cells[i].textContent = b.emoji;
              cells[i].dataset.name = b.name;
              cells[i].dataset.income = b.income;
            } else {
              cells[i].classList.remove('building');
              cells[i].textContent = '';
              delete cells[i].dataset.name;
              delete cells[i].dataset.income;
            }
          });
        }
      } catch {
        console.warn('Failed to load saved game');
      }
    }

    function resetProgress() {
      if (confirm("Are you sure you want to reset your progress? This cannot be undone.")) {
        localStorage.removeItem(SAVE_KEY);
        money = 100;
        incomePerMinute = 0;
        countdownSeconds = 60;
        selected = null;
        cells.forEach(cell => {
          cell.classList.remove('building');
          cell.textContent = '';
          delete cell.dataset.name;
          delete cell.dataset.income;
        });
        updateMoney();
        updateIncome();
        updateCountdown();
        showScreen('home');
      }
    }

    function goHome() {
      showScreen('home');
      if (incomeInterval) clearInterval(incomeInterval);
      if (countdownInterval) clearInterval(countdownInterval);
      saveGame();
      hideInfo();
    }

    function startCountdown() {
      updateCountdown();
      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        countdownSeconds--;
        if (countdownSeconds <= 0) {
          money += incomePerMinute;
          updateMoney();
          countdownSeconds = 60;
          saveGame();
        }
        updateCountdown();
      }, 1000);
    }

    function updateCountdown() {
      countdownDisplay.textContent = `Next paycheck in: ${countdownSeconds}s`;
    }
  </script>
</body>
</html>
